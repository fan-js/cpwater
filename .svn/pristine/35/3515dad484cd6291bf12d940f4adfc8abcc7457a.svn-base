/*
 *
 *
 */
package cn.ritac.mmbs.web.controller.sse;

import java.io.IOException;
import org.springframework.context.event.EventListener;
import org.springframework.scheduling.annotation.Async;
import org.springframework.stereotype.Component;
import org.springframework.util.StringUtils;
import org.springframework.web.servlet.mvc.method.annotation.SseEmitter;

/**
 *<b>Description:</b><br>
 * @author admin
 * @version V1.0<br>
 * @Note
 *<b>ProjectName:</b> mmbs
 *<br><b>ClassName:</b> PayCompletedListener
 *<br><b>CreatTime:</b> 2019年5月8日下午3:28:36
 */
@Component
public class SendMsgCompletedListener {

	private SseEmitter sseEmitter;

	public void addSseEmitters(SseEmitter sseEmitter) {
		this.sseEmitter = sseEmitter;
	}

	@Async
	@EventListener
	public void sendMsg(SendMsgCompletedEvent sendMsgCompletedEvent) throws IOException {
		String msgData = sendMsgCompletedEvent.getMsgData();
		if (!StringUtils.isEmpty(sseEmitter)) {
			sseEmitter.send(msgData);
			sseEmitter.complete();
		}
	}

}
